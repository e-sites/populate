(function($){"use strict";$.fn.extend({populate:function(nodes,options){var defaults={select:null,exclude:null,opPopulate:null,keepExistingSelection:false},optionNode='<option value="{key}">{value}</option>',htmlExpr=/^(?:(<[\w\W]+>)[^>]*|#([\w-]*))$/,opts=[],n;function template(node){return optionNode.replace("{key}",node.key).replace("{value}",node.value)}if(nodes instanceof Object){for(n in nodes){if(nodes.hasOwnProperty(n)){opts.push(template({key:n,value:nodes[n]}))}}}else if(nodes.constructor===String&&nodes!==""){if(htmlExpr.test(nodes)){opts=nodes}else{$.map(nodes.split("&"),function(val){opts.push(template({key:val.split("=")[0],value:val.split("=")[1].replace("+"," ")}))})}}return this.each(function(){var o=$.extend(defaults,options),self=this,$self=$(self);if(self.nodeName==="SELECT"){if(o.keepExistingSelection){var currentVal=$self.val()}$self.find(o.exclude?"option:not("+o.exclude+")":"option").remove().end().append(opts).removeAttr("disabled");if(o.select!==null){$(self.options).removeAttr("selected").filter(o.select).attr("selected","selected")}if(o.keepExistingSelection&&currentVal){$self.val(currentVal)}if(o.onPopulate&&$.isFunction(o.onPopulate)){o.onPopulate.apply(self,[opts])}}})}})})(jQuery);